# 동기화
- 특정 자원에 접근할 때 한개의 프로세스만 접근하게 하거나,
- 프로세스를 올바른 순서대로 실행하게 하는 것을 의미한다.

## '실행 순서를 위한 동기화'와 '상호 배제를 위한 동기화'
1. 실행 순서 제어를 위한 동기화 : 동시에 실행되는 프로세스를 올바른 순서대로 실행하는 것
2. 상호 배재를 위한 동기화 : 공유가 불가능한 자원의 동시 사용을 피하기 위해 사용하는 알고리즘

### 상호 배재를 위한 동기화의 '생산자'와 '소비자' 문제
- 생산자와 소비자 문제는 물건을 계속해서 생상하는 프로세스인 생산자와 물건을 계속해서 소비하는 프로세스인 소비자로 이루어져 있다.
- 생산자와 소비자는 '총합'이라는 데이터를 공유하고 있습니다.
- '총합'이라는 데이터를 동시에 사용하기 때문에 생산자 프로세스와 소비자 프로세스가 제대로 동기화 되지 않으면 문제가 발생한다.

### 동시에 접근하면 안되는 자원 : 임계구역
- 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역을 '임계구역' 이라고 한다.
- 두 개 이상의 프로세스가 임계 구역에 진입하고자 하면 둘 중 하나는 대기해야 한다.
- 여러 프로세스가 동시 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우가 있는데 이 경우를 "레이스 컨디션"이라고 한다.

### 상호 배제를 위한 동기화
- 컴퓨터는 고급 언어가 아닌 저급 언어를 실행하기 떄문에 여러줄의 저급 언어로 변환된 고급 언어 한 줄을 실행하는 과정에서 문맥 교환이 일어날 수 있음
- 상호 배제를 위한 동기화는 이와 같은 일이 발생하지 않도록 두개 이상의 프로세스가 임계 구역에 동시에 접근하지 못하도록 관리하는 것을 의미
#### 상호 배제를 위한 동기화 원칙 3가지
1. 상호 배제 : 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없다.
2. 진행 : 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 집입하고자 하는 프로세스는 들어갈 수 었어야 한다. 
3. 유한 대기 : 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 한다.
    - 임계 구역에 들어오기 위해 무한정 대기해서는 안된다.

# 동기화 기법
- 프로세스 동기화가 이루어지기 위한 도구
1. 뮤텍스 락
2. 세마포
3. 모니터 

## 1. 뮤텍스락
- 동시에 접근해서는 안되는 자원에 동시에 접근하지 않도록 만드는 도구
- 상호 배제를 위한 동기화 도구

### 뮤텍스락의 형태
- 하나의 전역 변수와 두개의 함수로 구현할 수 있음
1. 자물쇄 역할 **lock 전역 변수**
2. 임계 구역을 잠그는 역할 **acquire 함수**
3. 임계 구역의 잠금을 해제하는 역할 **release 함수**
~~~
acquire() {
    while (lock == true)
        ;
    lock = false
}
release() {
    lock = false
}

acquire();
// 임계구역
release();
~~~
- acquire 함수의 경우 임계 구역이 잠겨 있을 경우 프로세스는 반복적으로 lock을 확인
- 이런 대기 방식을 "바쁜 대기" 라고 한다.

## 2. 세마포
- 공유 자원이 여러 개 있는 상황에서도 적용이 가능한 동기화 도구
- 뮤텍스 락과 비슷하게 하나의 변수와 두개의 함수로 단순하게 구현할 수 있다.
1. 임계 구역에 진입할 수 있는 프로세스의 개수(사용가능한 공유 자원의 개수)를 나타내는 **전역 변수 S**
2. 임계 구역에 들어가도 좋은지, 기다려야 할지를 알려주는 **wait 함수**
3. 임계 구역 앞에서 기다리는 프로세스에 '이제 가도 좋다'고 신호를 주는 **signal 함수**
- 뮤텍스와 마찬가지로 바쁜 대기를 반복하며 CPU 주기를 낭비할 수 있다.
- 그래서! 프로세스의 PCB를 세마포를 위한 대기 큐에 집어넣는다.
- 다른 프로세스가 임계 구역에서의 작업이 끝나고 signal 함수를 호출하면 signal 함수는 대기중인 프로세스를 대기 큐에서 제거하고, 프로세스 상태를 준비 상태로 변경한 뒤 준비 큐로 옮겨준다.
~~~
wait() {
    S--;
    if( S < 0 ){
        add this process to Queue;
        sleep();
    }
}

signal() {
    S++;
    if( S <= 0 ){
        remove a process p from Queue
        wakeup(p)
    }
}
~~~

## 3. 모니터
- 모니터는 공유자원과 공유 자원에 접근하기 위한 인터페이스(통로)를 묶어 관리합니다.
- 그리고 프로세스는 반드시 인터페이스를 통해서만 공유 자우너에 접근하도록 합니다.
- 세마포와 마찬가지로 살행 순서 제어를 위한 동기화도 제공해줌
- 특정 조건을 바탕으로 프로세스를 실행하고 일시 중단하기 위해 모니터는 "조건 변수"를 사용한다.
    - 조건 변수란 프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 변수!!